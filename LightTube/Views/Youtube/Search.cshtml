@using YTProxy.Models
@model LightTube.Contexts.SearchContext

@{
	ViewBag.Title = Model.Query;
	Layout = "_Layout";
	ViewData["DisableOldCss"] = true;
	ViewData["UseFullSizeSearchBar"] = Model.MobileLayout;
}

<div class="video-list">
	@foreach (ItemPreview preview in Model.Results.Results)
	{
		Preview itemPreview = preview.GetPreview();
		switch (preview.GetPreview())
		{
			case VideoPreview video:
				<div class="video">
					<a href="/watch?v=@video.Id" class="thumbnail"
					   style="background-image: url('@video.Thumbnails.LastOrDefault()?.Url')"><span class="video-length">@video.Duration</span></a>
					<div class="info">
						<a href="/watch?v=@video.Id" class="title max-lines-2">@video.Title</a>
						<div style="display: flex; flex-direction: column; row-gap: 8px">
							<a href="/watch?v=@video.Id">
								<span>@video.Views views</span>
								<span>•</span>
								<span>@video.UploadedAt</span>
							</a>
							<a href="/channel/@video.Channel.Id"><img alt="Channel Avatar" src="@video.Channel.Avatars.LastOrDefault()?.Url"> @video.Channel.Name</a>
						</div>
					</div>
				</div>
				break;
			case PlaylistPreview playlist:
				<div class="playlist">
					<a href="/watch?v=@playlist.FirstVideoId&amp;list=@playlist.Id" class="thumbnail" style="background-image: url('@playlist.Thumbnails.LastOrDefault()?.Url')">
						<div>
							<span>@playlist.VideoCount</span>
							<span>VIDEOS</span>
						</div>
					</a>
					<div class="info">
						<a href="/watch?v=@playlist.Id" class="title max-lines-2">@playlist.Title</a>
						<div>
							<a href="/channel/@playlist.Channel.Id">@playlist.Channel.Name</a>
							<ul>
								<!--li><a href="#">Video #1 • 4:20</a></li-->
								<li><a href="/playlist?list=@playlist.Id">View Full Playlist</a></li>
							</ul>
						</div>
					</div>
				</div>
				break;
			case ChannelPreview channel:
				<div class="channel">
					<a href="/channel/@channel.Id" class="avatar">
						<img src="@channel.Thumbnails.LastOrDefault()?.Url" alt="Channel Avatar">
					</a>
					<a href="/channel/@channel.Id" class="info">
						<span class="name max-lines-2">@channel.Title</span>
						<div>
							<div>
								<span>@channel.Subscribers</span>
								<span>•</span>
								<span>@channel.VideoCount videos</span>
							</div>
							<p>@Html.Raw(channel.Description)</p>
						</div>
					</a>
					<button class="subscribe-button" data-cid="@channel.Id">Subscribe</button>
				</div>
				break;
			default:
				<div class="video">
					<span class="thumbnail"
					   style="background-image: url('@itemPreview.Thumbnails.LastOrDefault()?.Url')"><span class="video-length">@preview.Type</span></span>
					<div class="info">
						<span class="title max-lines-2">@itemPreview.Title</span>
						<div>
							<b>WARNING:</b> Unknown result type: @preview.Type
						</div>
					</div>
				</div>
				break;
		}
	}
</div>
<div class="pagination-buttons">
	@if (!string.IsNullOrWhiteSpace(Model.ContinuationToken))
	{
		<a href="/results?search_query=@Model.Query">First Page</a>
	}
	<div class="divider"></div>
	<span>•</span>
	<div class="divider"></div>
	@if (!string.IsNullOrWhiteSpace(Model.Results.ContinuationKey))
	{
		<a href="/results?search_query=@Model.Query&continuation=@Model.Results.ContinuationKey">Next Page</a>
	}
</div>